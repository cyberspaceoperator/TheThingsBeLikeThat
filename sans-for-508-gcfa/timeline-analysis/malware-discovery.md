# Malware Discovery

## Anomaly Detection

* Yara ([http://virustotal.github.io/yara/](http://virustotal.github.io/yara/))
  * Search for string and header-based signatures
  * Standard for IOC sharing
  * Easy to create custom signatures to detect new tools/malware
* Sigcheck
  * Microsoft tool designed to validate digital signatures
  * Create file hashes
  * Virus Total support
* DensityScout
  * Checks for possible obfuscation and packing
  * Files receive an entropy score
  * Score can be used to identify whether a set of file merits further investigation
* capa
  * File capability identification
  * Anti-analysis features
  * Contains and embedded .exe?
  * Interesting host interaction?
  * Code injection capabilities?

### Yara

```powershell
yara64.exe -C compiled-rules-file <file or directory>
```

![yara usage](https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-M9gEequSZFC\_6LxhQqB%2Fuploads%2FbF3JNeJ1gkd01MgKXqSv%2Fimage.png?alt=media\&token=98a028eb-786c-4a8a-9848-ddaa81e1d3b4)

### DensityScout

```bash
densityscout -pe -r -p 0.1 -o results.txt <directory-of-exe>
```

![densityscout usage](<../../.gitbook/assets/image (6).png>)

### SigCheck

![sigcheck](<../../.gitbook/assets/image (2) (1).png>)

{% hint style="danger" %}
Don't submit things to virustotal (-v) during an intrusion investigation, this may tip off the adversary if they have malware that is only present in your environment. Just check hashes instead
{% endhint %}

### capa

![capa analysis](<../../.gitbook/assets/image (5).png>)
