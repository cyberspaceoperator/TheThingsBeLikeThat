# Getting Started with Unpacking

## Things to try up-front

```
# Try the easy kill and try to use UPX self-unpacking capability

upx -d <malware.exe>
```

* Tweak the headers to get UPX to be able to unpack it
* Others tools like [Ether ](https://ether.gtisc.gatech.edu/web\_unpack/)and UnpacMe
* x64dbg unpacking scripts

## Manual Unpacking

{% hint style="warning" %}
ASLR causes issues for disassembly, disable it using CFF Explorer under NT Headers > File Headers > Optional Header > DllCharacteristics > "Click here" > Uncheck "DLL can move"
{% endhint %}

<figure><img src="../../.gitbook/assets/image (66).png" alt=""><figcaption><p>Disabling ASLR for disassembly with CFF Explorer</p></figcaption></figure>

1. Dump unpacked process from memory using Scylla
2. Rebuild the dumped file
   1. Open the process in Scylla
   2. Press IAT Autosearch
   3. Get Imports
   4. Fix Dump, select the dump we previously created > click Open
3. The process can be analyzed but probably not run, probably because the "entry point" still points to the beginning of the original unpacker, we fix this in the next section



## Tools

| Tool                                                 | Usage                                                                                                                                       | Description                                                            |
| ---------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------- |
| [Ether](https://ether.gtisc.gatech.edu/web\_unpack/) |                                                                                                                                             |                                                                        |
| UnpacMe                                              |                                                                                                                                             |                                                                        |
| CFF Explorer                                         | <p>See Screenshot above<br><br>NT Headers > File Headers > Optional Header > DllCharacteristics > "Click here" > Uncheck "DLL can move"</p> | Disables ASLR for the executable so you can more easily disassemble it |
| setdllcharacteristics                                | setdllcharacteristics -d \<path to malware>                                                                                                 | Disables ASLR for executable                                           |
| Scylla                                               |                                                                                                                                             | Dumps unpacked process from memory                                     |
| Imports Fixer                                        |                                                                                                                                             |                                                                        |
| PE Tools                                             |                                                                                                                                             |                                                                        |
